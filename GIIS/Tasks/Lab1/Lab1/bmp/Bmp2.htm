<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><script src="Bmp2_files/hubclient.js" async="" type="text/javascript" id="LR1"></script><script src="Bmp2_files/shares.json" type="text/javascript"></script><script async="" src="Bmp2_files/cbgapi.loaded_0"></script><script src="Bmp2_files/counter002C.js" type="text/javascript"></script><link media="all" href="Bmp2_files/counter002C.css" type="text/css" rel="stylesheet"><script src="Bmp2_files/widgets.js" type="text/javascript"></script><script gapi_processed="true" src="Bmp2_files/plusone.js" async="true" type="text/javascript"></script><link media="all" href="Bmp2_files/widget092.css" type="text/css" rel="stylesheet">
  <title>Описание формата BMP   | Софт, исходники и фото</title>
  <meta http-equiv="Content-Style-Type" content="text/css">
  <link rel="stylesheet" href="Bmp2_files/pmwiki.css" type="text/css">

<link rel="openid.server" href="http://jenyay.net/phpmyopenid/index.php">
<link rel="openid.delegate" href="http://jenyay.net/phpmyopenid/index.php"> 
<link rel="me" type="text/html" href="http://www.google.com/profiles/jenyay.ilin">

  <!--HTMLHeader--><style type="text/css"><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code.escaped { white-space: nowrap; }
  .vspace { margin-top:1.33em; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  
div.tabledit {text-align:right;font-size:smaller;}
.editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }

  table.markup { border:2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  table.vert td.markup1 { border-bottom:1px solid #ccf; }
  table.horiz td.markup1 { width:23em; border-right:1px solid #ccf; }
  table.markup caption { text-align:left; }
  div.faq p, div.faq pre { margin-left:2em; }
  div.faq p.question { margin:1em 0 0.75em 0; font-weight:bold; }
  div.faqtoc div.faq * { display:none; }
  div.faqtoc div.faq p.question 
    { display:block; font-weight:normal; margin:0.5em 0 0.5em 20px; line-height:normal; }
  div.faqtoc div.faq p.question * { display:inline; }
   
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none; }
/**
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 */
.cpp  {font-family:monospace;}
.cpp .imp {font-weight: bold; color: red;}
.cpp .kw1 {color: #0000ff;}
.cpp .kw2 {color: #0000ff;}
.cpp .kw3 {color: #0000dd;}
.cpp .kw4 {color: #0000ff;}
.cpp .co1 {color: #666666;}
.cpp .co2 {color: #339900;}
.cpp .coMULTI {color: #ff0000; font-style: italic;}
.cpp .es0 {color: #000099; font-weight: bold;}
.cpp .es1 {color: #000099; font-weight: bold;}
.cpp .es2 {color: #660099; font-weight: bold;}
.cpp .es3 {color: #660099; font-weight: bold;}
.cpp .es4 {color: #660099; font-weight: bold;}
.cpp .es5 {color: #006699; font-weight: bold;}
.cpp .br0 {color: #008000;}
.cpp .sy0 {color: #008000;}
.cpp .sy1 {color: #000080;}
.cpp .sy2 {color: #000040;}
.cpp .sy3 {color: #000040;}
.cpp .sy4 {color: #008080;}
.cpp .st0 {color: #FF0000;}
.cpp .nu0 {color: #0000dd;}
.cpp .nu6 {color: #208080;}
.cpp .nu8 {color: #208080;}
.cpp .nu12 {color: #208080;}
.cpp .nu16 {color:#800080;}
.cpp .nu17 {color:#800080;}
.cpp .nu18 {color:#800080;}
.cpp .nu19 {color:#800080;}
.cpp .me1 {color: #007788;}
.cpp .me2 {color: #007788;}
.cpp span.xtra { display:block; }

.sourceblocklink {
  text-align: right;
  font-size: smaller;
}
.sourceblocktext {
  padding: 0.5em;
  border: 1px solid #808080;
  color: #000000;
  background-color: #f1f0ed;
}
.sourceblocktext div {
  font-family: monospace;
  font-size: small;
  line-height: 1;
  height: 1%;
}
.sourceblocktext div.head,
.sourceblocktext div.foot {
  font: italic medium serif;
  padding: 0.5em;
}

--></style><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">   
   <link href="Bmp2_files/fox.css" rel="stylesheet" type="text/css" media="screen">
   <script language="javascript" type="text/javascript" src="Bmp2_files/guiedit.js"></script>
<link rel="alternate" title="Софт, исходники и фото" href="http://jenyay.net/blog/feed/" type="application/rss+xml">  <meta name="robots" content="index,follow">
<meta name="keywords" content="формат bmp, bmp, описание, программирование, C++, winapi, win32, windows, как читать, исходник, заголовки ">
<meta name="description" content="Статья с описанием графического формата BMP и примеры его использования на языке C++">

<div id="_atssh" style="visibility: hidden; height: 1px; width: 1px; position: absolute; z-index: 100000;"><iframe src="Bmp2_files/sh098.htm" style="height: 1px; width: 1px; position: absolute; z-index: 100000; border: 0pt none; left: 0pt; top: 0pt;" title="AddThis utility frame" id="_atssh738"></iframe></div><script src="Bmp2_files/core032.js" type="text/javascript"></script></head>
<body data-twttr-rendered="true"><iframe src="Bmp2_files/hub.htm" style="position: absolute; top: -9999em; width: 10px; height: 10px;" name="twttrHubFrameSecure" tabindex="0" allowtransparency="true" id="twttrHubFrameSecure" frameborder="0" scrolling="no"></iframe><iframe src="Bmp2_files/hub_002.htm" style="position: absolute; top: -9999em; width: 10px; height: 10px;" name="twttrHubFrame" tabindex="0" allowtransparency="true" id="twttrHubFrame" frameborder="0" scrolling="no"></iframe>
<!--PageHeaderFmt-->
  <div id="wikilogo" align="center"><script type="text/javascript" src="Bmp2_files/orphus.js"></script>
<a title="Система Orphus" href="http://orphus.ru/" id="orphus" target="_blank"><img alt="Система Orphus" src="Bmp2_files/Oleg_Fadjarov_btn2.gif" style="vertical-align: middle;" border="0" height="48" width="257"></a></div>
  <div id="wikihead">
  <form action="http://jenyay.net">
    <span class="headnav"><a href="http://jenyay.net/Programming/RecentChanges" accesskey="c">Последние изменения</a> -</span>
    <input name="n" value="Programming.Bmp" type="hidden">
    <input name="action" value="search" type="hidden">
    <a href="http://jenyay.net/PmWikiRu/SiteSearch">Поиск</a>:
    <input name="q" class="inputbox searchbox" type="text">
    <input class="inputbutton searchbutton" value="&gt;&gt;" type="submit"></form></div>
<!--/PageHeaderFmt-->
  <table id="wikimid" cellpadding="0" cellspacing="0" width="100%"><tbody><tr>
<!--PageLeftFmt-->
      <td id="wikileft" valign="top">
        <div align="center"><a href="http://jenyay.net/blog/feed/"><img src="Bmp2_files/feed.png" alt="RSS" title="RSS" border="0" height="48" width="48"></a></div>
<div class="vspace"></div><form style="padding:3px;text-align:center;" action="http://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open('http://feedburner.google.com/fb/a/mailverify?uri=jenyaynet', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true"><p>Подписка по E-mail:</p><p><input style="width: 140px;" name="email" type="text"></p><input value="jenyaynet" name="uri" type="hidden"><input name="loc" value="en_US" type="hidden"><input value="Подписаться" type="submit"></form>
<p class="vspace sidehead"> <a class="urllink" href="http://jenyay.net/">Начало</a>
</p>
<p class="vspace sidehead"> <a class="urllink" href="http://jenyay.net/blog">Блог</a>
</p>
<p class="vspace sidehead"> <a class="wikilink" href="http://jenyay.net/Soft/HomePage">Программки</a>
</p><div class="indent"><a class="wikilink" href="http://jenyay.net/Soft/Outwiker">OutWiker</a>
</div><div class="indent">&nbsp;&nbsp;&nbsp;&nbsp;<a class="wikilink" href="http://jenyay.net/Outwiker/Plugins">Плагины</a>
</div><div class="indent">&nbsp;&nbsp;&nbsp;&nbsp;<a class="wikilink" href="http://jenyay.net/Outwiker/Unstable">Бета-версии</a>
</div><div class="indent">&nbsp;&nbsp;&nbsp;&nbsp;<a class="urllink" href="http://outwiker.reformal.ru/">Предложения</a>
</div><div class="indent">&nbsp;&nbsp;&nbsp;&nbsp;<a class="urllink" href="http://crowdin.net/project/outwiker">Локализации</a>
<div class="vspace"></div></div><div class="indent"><a class="wikilink" href="http://jenyay.net/Soft/Texgui">TeXGui</a>
</div><div class="indent"><a class="wikilink" href="http://jenyay.net/Soft/SmilesArchive">SmilesArchive</a>
</div><div class="indent"><a class="wikilink" href="http://jenyay.net/Soft/HomePage">Другие…</a>
</div><p class="vspace sidehead"> <a class="wikilink" href="http://jenyay.net/Soft/Plugins">Плагины</a>
</p>
<p class="vspace sidehead"> <a class="wikilink" href="http://jenyay.net/Programming/HomePage">Программирование</a>
</p><div class="indent"><a class="wikilink" href="http://jenyay.net/Programming/Net">.NET/C#</a>
</div><div class="indent"><a class="wikilink" href="http://jenyay.net/Programming/Cpp">C++</a>
</div><div class="indent"><a class="wikilink" href="http://jenyay.net/Programming/Python">Python</a>
</div><div class="indent"><a class="wikilink" href="http://jenyay.net/Programming/Php">PHP</a>
</div><div class="indent"><a class="wikilink" href="http://jenyay.net/Programming/Algorithm">Алгоритмы</a>
</div><div class="indent"><a class="wikilink" href="http://jenyay.net/Programming/Tools">Инструменты</a>
</div><div class="indent"><a class="wikilink" href="http://jenyay.net/Programming/Other">Остальное</a>
</div><p class="vspace sidehead"> <a class="wikilink" href="http://jenyay.net/Photo/HomePage">Фото</a>
</p><div class="indent"><a class="wikilink" href="http://jenyay.net/Photo/Animals">Животные</a>
</div><div class="indent"><a class="wikilink" href="http://jenyay.net/Photo/BlackWhite">Черно-белые</a>
</div><div class="indent"><a class="wikilink" href="http://jenyay.net/Photo/Nature">Пейзажи/Природа</a>
</div><div class="indent"><a class="wikilink" href="http://jenyay.net/Photo/City">Город</a>
</div><div class="indent"><a class="wikilink" href="http://jenyay.net/Photo/Sunset">Закаты</a>
</div><div class="indent"><a class="wikilink" href="http://jenyay.net/Photo/Panoram">Панорамы</a>
</div><div class="indent"><a class="wikilink" href="http://jenyay.net/Photo/Sport">Спорт</a>
</div><div class="indent"><a class="wikilink" href="http://jenyay.net/Photo/Story">Репортаж</a>
</div><div class="indent"><a class="wikilink" href="http://jenyay.net/Photo/Other">Разное</a>
</div><p class="vspace sidehead"> <a class="wikilink" href="http://jenyay.net/Main/Contact">Контакты</a>
</p>
<div class="vspace"></div><div align="center"><a href="http://twitter.com/jenyay" rel="nofollow"><img src="Bmp2_files/twitter.png" alt="Я в твиттере" title="Я в твиттере" border="0"></a> <a href="http://jenyay.livejournal.com/" rel="nofollow"><img src="Bmp2_files/livejournal.png" alt="Я в ЖЖ" title="Я в ЖЖ" border="0" height="48" width="48"></a> <a href="https://plus.google.com/104188031510513584502/posts" rel="author"><img src="Bmp2_files/gogle_plus_48.png" alt="Я в Google+" title="Я в Google+" border="0"></a></div>
</td>
<!--/PageLeftFmt-->
      <td id="wikibody" valign="top">
<!--PageActionFmt-->
        <div id="wikicmds"><ul><li class="browse">      <a accesskey="" rel="nofollow" class="selflink" href="http://jenyay.net/Programming/Bmp">Просмотр</a>
</li><li class="edit">      <a accesskey="e" rel="nofollow" class="wikilink" href="http://jenyay.net/Programming/Bmp?action=edit">Править</a>
</li><li class="diff">   <a accesskey="h" rel="nofollow" class="wikilink" href="http://jenyay.net/Programming/Bmp?action=diff">История</a>
</li><li class="print">     <a accesskey="" rel="nofollow" class="wikilink" href="http://jenyay.net/Programming/Bmp?action=print">Печать</a>
</li></ul>
</div>
<!--PageTitleFmt-->
        <div id="wikititle">
          <div class="pagegroup"><!--<a href='http://jenyay.net/Programming'>Programming</a> /--></div>
          <h1 class="pagetitle">Описание формата BMP </h1></div>
<!--PageText-->
<div id="wikitext">
<p class="vspace" style="text-align: center;"><script type="text/javascript"><!--
google_ad_client = 'ca-pub-4934988039890493';
/* article */
google_ad_slot = '2994245369';
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript" src="Bmp2_files/show_ads.js">
</script><ins style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px"><ins id="aswift_0_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px"><iframe allowtransparency="true" hspace="0" marginwidth="0" marginheight="0" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){i+='.call';setTimeout(h,0)}else if(h.match){i+='.nav';w.location.replace(h)}s.log&amp;&amp;s.log.push(i)}" vspace="0" id="aswift_0" name="aswift_0" style="left: 0pt; position: absolute; top: 0pt;" frameborder="0" height="90" scrolling="no" width="728"></iframe></ins></ins>
</p>
<p class="vspace">Эта статья про то, как выглядит графический формат 
bmp. Хоть это и один из простых форматов, но из-за того, что существует 
много вариаций этого формата, то не все моменты очевидны. Итак, хватит 
лить воду, начнем.
</p>
<div class="vspace"></div><h3>Структуры формата</h3>
<p>Формат bmp (от слов BitMaP - битовая карта, или, говоря по-русски, 
битовый массив) представляет из себя несжатое (в основном) изображение, 
которое довольно легко читается и выводится в ОС Windows, в которой есть
 специальные функции API, которые в этом помогают.
</p>
<p class="vspace">Для начала приведем графическое представление данных в bmp (картинка взята из MSDN).
</p>
<div class="vspace"></div><div style="text-align: center;"> <img src="Bmp2_files/struct.gif" alt="" title=""></div>
<p class="vspace"><br>В начале стоит заголовок файла (BITMAPFILEHEADER). Он описан следующим образом: <br>
</p>
<div class="sourceblock " id="sourceblock1">
  <div class="sourceblocktext"><div class="cpp" style="font-family:monospace;"><span class="kw4">typedef</span> <span class="kw4">struct</span> tagBITMAPFILEHEADER <br>
&nbsp;<span class="br0">{</span> <br>
&nbsp; &nbsp;WORD &nbsp; &nbsp;bfType<span class="sy4">;</span> <br>
&nbsp; &nbsp;DWORD &nbsp; bfSize<span class="sy4">;</span> <br>
&nbsp; &nbsp;WORD &nbsp; &nbsp;bfReserved1<span class="sy4">;</span> <br>
&nbsp; &nbsp;WORD &nbsp; &nbsp;bfReserved2<span class="sy4">;</span> <br>
&nbsp; &nbsp;DWORD &nbsp; bfOffBits<span class="sy4">;</span> <br>
&nbsp;<span class="br0">}</span> BITMAPFILEHEADER, <span class="sy2">*</span>PBITMAPFILEHEADER<span class="sy4">;</span></div></div>
  <div class="sourceblocklink"><a href="http://jenyay.net/Programming/Bmp?action=sourceblock&amp;num=1" type="text/plain">[$[Get Code]]</a></div>
</div>

<p class="vspace"><em>bfType</em> определяет тип файла. Здесь он должен 
быть BM. Если Вы откроете любой файл BMP в текстовом (а лучше в 
16-ричном редакторе), то увидите, что первые два символа - это BM (от 
слова BitMap, как вы уже, наверное, догадались). <br><em>bfSize</em> - 
это размер самого файла в байтах. Строго говоря вы должны его 
высчитывать (что рекомендуется), но я ставил размер файла неправильно 
(правда, не нарочно :)) и никаких проблем не было (ACDSee читало без 
проблем, моя программа работала), но я вам не рекомендую писать его 
заведомо неправильно, вдруг появится добросовестная программа, которая 
сверит этот размер с настоящим и решит, что это не bmp, а что-нибудь 
другое. В идеале все программы для того, чтобы убедиться, что перед ними
 действительно bmp, а не подделка, должны, во-первых, проверить, что 
bfType содержит "BM" (без кавычек), а, во-вторых, что bfSize равен 
размеру файла. <br><em>bfReserved1 и bfReserved2</em> зарезервированы и должны быть нулями. <br><em>bfOffBits</em>.
 Это один из самых важных полей в этой структуре. Он показывает, где 
начинается сам битовый массив относительно начала файла (или, как 
написано в MSDN, "от начала структуры BITMAPFILEHEADER"), который и 
описывает картинку. То есть, чтобы гарантированно попадать на начало 
массива вы должны писать: <br>
</p>
<div class="sourceblock " id="sourceblock2">
  <div class="sourceblocktext"><div class="cpp" style="font-family:monospace;">SetFilePointer <span class="br0">(</span>hFile, bfh.<span class="me1">bfOffBits</span>, <span class="kw2">NULL</span>, FILE_BEGIN<span class="br0">)</span><span class="sy4">;</span></div></div>
  <div class="sourceblocklink"><a href="http://jenyay.net/Programming/Bmp?action=sourceblock&amp;num=2" type="text/plain">[$[Get Code]]</a></div>
</div>

<p class="vspace">Здесь и далее будем считать, что переменная bfh объявлена как BITMAPFILEHEADER bfh;
</p>
<p class="vspace">А дальше идет структура BITMAPINFOHEADER, которая объявлена так:
</p>
<div class="vspace"></div>
<div class="sourceblock " id="sourceblock3">
  <div class="sourceblocktext"><div class="cpp" style="font-family:monospace;"><span class="kw4">typedef</span> <span class="kw4">struct</span> tagBITMAPINFOHEADER<br>
&nbsp;<span class="br0">{</span><br>
&nbsp; &nbsp;DWORD &nbsp;biSize<span class="sy4">;</span> <br>
&nbsp; &nbsp;LONG &nbsp; biWidth<span class="sy4">;</span> <br>
&nbsp; &nbsp;LONG &nbsp; biHeight<span class="sy4">;</span> <br>
&nbsp; &nbsp;WORD &nbsp; biPlanes<span class="sy4">;</span> <br>
&nbsp; &nbsp;WORD &nbsp; biBitCount<span class="sy4">;</span> <br>
&nbsp; &nbsp;DWORD &nbsp;biCompression<span class="sy4">;</span> <br>
&nbsp; &nbsp;DWORD &nbsp;biSizeImage<span class="sy4">;</span> <br>
&nbsp; &nbsp;LONG &nbsp; biXPelsPerMeter<span class="sy4">;</span> <br>
&nbsp; &nbsp;LONG &nbsp; biYPelsPerMeter<span class="sy4">;</span> <br>
&nbsp; &nbsp;DWORD &nbsp;biClrUsed<span class="sy4">;</span> <br>
&nbsp; &nbsp;DWORD &nbsp;biClrImportant<span class="sy4">;</span> <br>
&nbsp;<span class="br0">}</span> BITMAPINFOHEADER, <span class="sy2">*</span>PBITMAPINFOHEADER<span class="sy4">;</span></div></div>
  <div class="sourceblocklink"><a href="http://jenyay.net/Programming/Bmp?action=sourceblock&amp;num=3" type="text/plain">[$[Get Code]]</a></div>
</div>

<p class="vspace"><em>biSize</em> - это размер самой структуры. Ее нужно инициализировать следующим образом: bih.biSize = sizeof (BITMAPINFOHEADER); <br>Снова здесь и дальше будем считать, что bih объявлена следующим образом: BITMAPINFOHEADER bih; <br><em>biWidth и biHeight</em> задают соответственно ширину и высоту картинки в пикселях. <br><em>biPlanes</em> задает количество плоскостей. Пока оно всегда устанавливается в 1. <br><em>biBitCount</em> - Количество бит на один пиксель. Подробнее про это поговорим ниже. <br><em>biCompression</em>
 обозначает тип сжатия. Не удивляйтесь и не пугайтесь, что в bmp и вдруг
 сжатие. Я лично не видел не одной сжатой bmp (но я не говорю, что таких
 не существует). Если сжатия нет, то этот флаг надо устанавливать в 
BI_RGB. В этой статье мы говорим про несжатый формат, поэтому другие 
флаги я даже не буду перечислять. Похоже, что эта же структура 
используется и в файлах JPEG и PNG, потому что, начиная с Windows 98 тут
 появились варианты BI_JPEG, которая показывает, что эта картинка - JPEG
 и BI_PNG, что это PNG (про формат Jpeg я ничего не знаю, я только 
сделал эти выводы исходя из того, что написано в MSDN). <br><em>biSizeImage</em>
 обозначает размер картинки в байтах. Если изображение несжато (то есть 
предыдущее поле установлено в BI_RGB), то здесь должен быть записан 
ноль. <em>biXPelsPerMeter</em> и <em>biYPelsPerMeter</em> обозначают 
соответственно горизонтальное и вертикальное разрешение (в пикселях на 
метр) конечного устройства, на которое будет выводиться битовый массив 
(растр). Приложение может использовать это значение для того, чтобы 
выбирать из группы ресурсов наиболее подходящий битовый массив для 
нужного устройства. Дело в том, что формат bmp - это по сути 
аппаратно-независимый растр, то есть когда внешний вид того, что 
получается не зависит от того, на что этот растр проецируется (если 
можно так выразится). Например, картинка будет выглядеть одинаково вне 
зависимости от того, рисуется она на экране монитора или печатается на 
принтере. Но вот разрешение у устройств разное, и именно для того, чтобы
 выбрать наиболее подходящую картинку из имеющихся и используют эти 
параметры. <br><em>biClrUsed</em> определяет количество используемых 
цветов из таблицы. Если это значение равно нулю, то в растре 
используется максимально возможное количество цветов, которые разрешены 
значением biBitCount. Это актуально только для сжатых картинок. Если 
biClrUsed не нуль и biBitCount меньше 16, то biClrUsed определяет 
текущее число цветов графического движка или доступного драйвера 
устройства. Если biBitCount больше или равно 16, то biClrUsed определяет
 размер таблицы цветов, используемой для оптимизации текущей системной 
палитры. <br><em>biClrImportant</em> - это количество важных цветов. 
Определяет число цветов, которые необходимы для того, чтобы изобразить 
рисунок. Если это значение равно 0 (как это обычно и бывает), то все 
цвета считаются важными.
</p>
<div class="vspace"></div><h3>Виды формата BMP</h3>
<p>Все разновидности формата bmp <strong>условно</strong> можно 
разделить на два типа: палитровые и беспалитровые. То есть используется в
 данном с формате палитра или нет. Заметьте, что палитра может быть даже
 в беспалитровых форматах, только там она не используется. В 
беспалитровых bmp цвет высчитывается прямо из тех битов, которые идут в 
файле, начиная с некоторого места. А в палитровых каждый байт описывает 
один или несколько пикселей, причем значения байта (или битов) - это 
индекс цвета в палитре. Для начала приведу таблицу, которая сравнивает 
возможные варианты. Вид картинки (палитровая или беспалитровая) зависит 
от того, сколько бит отдается на один пиксель, то есть от значения 
biBitCount структуры BITMAPINFOHEADER.
</p>
<div class="vspace"></div>
<table border="1"><tbody><tr><td align="left">biBitCount</td><td align="left">Палитровый или беспалитровый формат</td><td align="left">Максимально возможное количество цветов</td><td align="left">Примечания</td></tr>
<tr><td align="left">1</td><td align="left">Палитровый</td><td align="left">2</td><td align="left">Двуцветная,
 заметьте, не обязательно черно-белая, палитровая картинка. Если бит 
растра (что это такое чуть ниже) сброшен (равен 0), то это значит, что 
на этом месте должен быть первый цвет из палитры, а если установлен 
(равен 1), то второй.</td></tr>
<tr><td align="left">4</td><td align="left">Палитровый</td><td align="left">16</td><td align="left">Каждый байт описывает 2 пикселя. Вот пример из <a class="urllink" href="http://msdn.microsoft.com/">MSDN</a>.Если
 первый байт в картинке 0x1F, то он соответствует двум пикселям, цвет 
первого - второй цвет из палитры (потому что отсчет идет от нуля), а 
второй пиксель - 16-й цвет палитры.</td></tr>
<tr><td align="left">8</td><td align="left">Палитровый</td><td align="left">256</td><td align="left">Один
 из самых распространенных вариантов. Но в то же время и самых простых. 
Палитра занимает один килобайт (но на это лучше не рассчитывать). Один 
байт - это один цвет. Причем его значение - это номер цвета в палитре.</td></tr>
<tr><td align="left">16</td><td align="left">Беспалитровый</td><td align="left">2^16 или 2^15</td><td align="left">Это
 самый запутанный вариант. Начнем с того, что он беспалитровый, то есть 
каждые два байта (одно слово WORD) в растре однозначно определяют один 
пиксель. Но вот что получается: битов-то 16, а компонентов цветов - 3 
(Красный, Зеленый, Синий). А 16 никак на 3 делиться не хочет. Поэтому 
здесь есть два варианта. Первый - использовать не 16, а 15 битов, тогда 
на каждую компоненту цвета выходит по 5 бит. Таким образом мы можем 
использовать максимум 2^15 = 32768 цветов и получается тройка R-G-B = 
5-5-5. Но тогда за зря теряется целый бит из 16. Но так уж случилось, 
что наши глаза среди всех цветов лучше воспринимают зеленый цвет, 
поэтому и решили этот один бит отдавать на зеленую компоненту, то есть 
тогда получается тройка R-G-B = 5-6-5, и теперь мы может использовать 
2^16 = 65536 цветов. Но что самое неприятное, что используют оба 
варианта. В MSDN предлагают для того, чтобы различать сколько же цветов 
используется, заполнять этим значением поле biClrUsed из структуры 
BITMAPINFOHEADER. Чтобы выделить каждую компоненту надо использовать 
следующие маски. Для формата 5-5-5: 0x001F для синей компоненты, 0x03E0 
для зеленой и 0x7C00 для красной. Для формата 5-6-5: 0x001F - синяя, 
0x07E0 - зеленая и 0xF800 красная компоненты соответственно.</td></tr>
<tr><td align="left">24</td><td align="left">Беспалитровый</td><td align="left">2^24</td><td align="left">А
 это самый простой формат. Здесь 3 байта определяют 3 компоненты цвета. 
То есть по компоненте на байт. Просто читаем по структуре RGBTRIPLE и 
используем его поля rgbtBlue, rgbtGreen, rgbtRed. Они идут именно в 
таком порядке.</td></tr>
<tr><td align="left">32</td><td align="left">Беспалитровый</td><td align="left">2^32</td><td align="left">Здесь
 4 байта определяют 3 компоненты. Но, правда, один байт не используется.
 Его можно отдать, например, для альфа-канала (прозрачности). Читать 
растр в данном случае удобно структурами RGBQUAD, которая описана так: <br clear="all"></td></tr>
</tbody></table>
<div class="vspace"></div>
<div class="sourceblock " id="sourceblock4">
  <div class="sourceblocktext"><div class="cpp" style="font-family:monospace;"><span class="kw4">typedef</span> <span class="kw4">struct</span> tagRGBQUAD <br>
&nbsp;<span class="br0">{</span><br>
&nbsp; &nbsp;BYTE &nbsp; &nbsp;rgbBlue<span class="sy4">;</span> <br>
&nbsp; &nbsp;BYTE &nbsp; &nbsp;rgbGreen<span class="sy4">;</span> <br>
&nbsp; &nbsp;BYTE &nbsp; &nbsp;rgbRed<span class="sy4">;</span> <br>
&nbsp; &nbsp;BYTE &nbsp; &nbsp;rgbReserved<span class="sy4">;</span> <br>
&nbsp;<span class="br0">}</span> RGBQUAD<span class="sy4">;</span></div></div>
  <div class="sourceblocklink"><a href="http://jenyay.net/Programming/Bmp?action=sourceblock&amp;num=4" type="text/plain">[$[Get Code]]</a></div>
</div>

<div class="vspace"></div><h3>Хранение данных в формате bmp</h3>
<p>Ну вот и подошли к самому интересному. После структур 
BITMAPFILEHEADER и BITMAPINFOHEADER идет палитра. Причем, если формат 
беспалитровый, то ее может и не быть, однако, на это рассчитывать не 
надо. Дело в том, что, когда я только начинал разбираться с форматом 
bmp, в одной книжке я вычитал, что, якобы, если формат беспалитровый, то
 у нее вообще нет палитры. Там даже были две картинки - схемы формата: 
одна с палитрой, другая без. А я в это время писал программу, которая 
усердно оперирует с bmp-шками. И мне надо было преобразовывать входящие 
картинки из 256 цветов в 24-битные (если таковые имелись) во временные 
файлы. И я в 24-битных палитру просто не создавал (bfOffBits из 
структуры BITMAPFILEHEADER у меня был равен сумме 
sizeof(BITMAPFILEHEADER) + sizeof (BITMAPINFOHEADER), а входящие 
24-разрядные оставлял без изменений. С 256-цветными растрами все 
работало как надо, пока мне не попалась 24-разрядная картинка, у которой
 внизу вместо нужной части отображался мусор. Я не сразу понял в чем 
дело. Пока не сравнил размер исходного файла с теоретическим, который 
должен был быть, не будь палитры. Разница оказалась ровно 1 Kб (ровно 
1024 байта). Там была палитра. Поэтому никогда не рассчитывайте на то, 
есть ли палитра и не надейтесь на ее размер (хотя все картинки, которые 
мне попадались имели размер палитры 256 цветов, или 1Кб), всегда 
перемещайтесь по файлу на начало растра, используя bfOffBits. Палитра 
представляет из себя массив структур RGBQUAD идущих друг за другом. Даже
 если в палитре используются не все цвета (а только, например, 16), то 
часто все равно под палитру отводят 256 полей. А 256 * 4 = 1024, где 4 -
 размер структуры RGBQUAD, то есть и получается тот самый один килобайт.
</p>
<p class="vspace">Сразу за палитрой идет сам растр. Тут уже более 
запутано. Во-первых, пиксели тут описываются так, как написано в таблице
 выше в зависимости от формата. И могут сами содержать значение 
компонентов цвета (для беспалитровых), а могут быть индексами 
массива-палитры. Сама картинка записывается построчно. Во-вторых, 
картинка идет как бы перевернутая вверх ногами. То есть сначала записана
 нижняя строка, потом предпоследняя и так далее до самого верха. И, 
в-третьих, как написано в [1], если размер строки растра не кратен 4, то
 она дополняется от 1 до 3 пустыми (нулевыми) байтами, чтобы длина 
строки оказалась кратна параграфу. Вот это и есть самое неприятное. Дело
 в том, что для каждого формата приходится подстраивать это число пустых
 байтов (правда, я люблю туда записывать часть палитры, просто мне не 
хочется заводить лишние "нулевые" переменные, если все-равно эти байты 
пропускают и никому они не нужны). Я привожу таблицу с формулами, 
которые показывают для какого формата сколько байт надо дописывать в 
конец строки. Там под переменной Width, как можно догадаться, 
подразумевается ширина картинки. Все эти формулы были установлены 
экспериментально. Я приведу пример только для наиболее используемых 
форматов. Для остальных вы можете написать сами.
</p>
<div class="vspace"></div>
<table align="center" border="1"><tbody><tr><td align="left">biBitCount</td><td align="left">Формула на С</td></tr>
<tr><td align="left">8</td><td align="left">(3 * Width) % 4</td></tr>
<tr><td align="left">16</td><td align="left">(2 * Width) % 4</td></tr>
<tr><td align="left">24</td><td align="left">Width % 4</td></tr>
</tbody></table>
<div class="vspace"></div><h3>Примеры программ</h3>
<p>Все исходники вы можете скачать <a class="urllink" href="http://jenyay.net/uploads/Programming/Bmp/bmp.zip">отсюда</a>.Я особо не буду тут много писать. Просто приведу функции с комментариями.
</p>
<p class="vspace">Привет 1. Создание картинки в формате bmp.  <br>Здесь создается однотонная картинка. В примерах таких функций три: создание bmp 8, 16 и 24 бит. Я приведу только для 16-битных.
</p>
<div class="vspace"></div>
<div class="sourceblock " id="sourceblock5">
  <div class="sourceblocktext"><div class="cpp" style="font-family:monospace;"><span class="co1">// Создадим картинку в формате bmp 16 бит типа 5-5-5, которая будет просто однотонной</span><br>
&nbsp;<span class="kw4">void</span> CreateBmp555 <span class="br0">(</span><span class="kw4">char</span> <span class="sy2">*</span>fname, WORD color<span class="br0">)</span><br>
&nbsp;<span class="br0">{</span><br>
&nbsp; &nbsp; &nbsp;HANDLE hFile<span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;DWORD RW<span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;<span class="kw4">int</span> i, j<span class="sy4">;</span><br>
<br>
&nbsp; &nbsp; &nbsp;<span class="co1">// Объявим нужные структуры</span><br>
&nbsp; &nbsp; &nbsp;BITMAPFILEHEADER bfh<span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;BITMAPINFOHEADER bih<span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;BYTE Palette <span class="br0">[</span><span class="nu0">1024</span><span class="br0">]</span><span class="sy4">;</span> &nbsp; &nbsp;<span class="co1">// Палитра</span><br>
<br>
&nbsp; &nbsp; &nbsp;<span class="co1">// Пусть у нас будет картинка размером 35 x 50 пикселей</span><br>
&nbsp; &nbsp; &nbsp;<span class="kw4">int</span> Width <span class="sy1">=</span> <span class="nu0">35</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;<span class="kw4">int</span> Height <span class="sy1">=</span> <span class="nu0">50</span><span class="sy4">;</span><br>
<br>
&nbsp; &nbsp; &nbsp;<span class="kw3">memset</span> <span class="br0">(</span>Palette, <span class="nu0">0</span>, <span class="nu0">1024</span><span class="br0">)</span><span class="sy4">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">// В палитре у нас нули заполним их</span><br>
&nbsp; &nbsp; &nbsp;<span class="kw3">memset</span> <span class="br0">(</span><span class="sy3">&amp;</span>bfh, <span class="nu0">0</span>, <span class="kw3">sizeof</span><span class="br0">(</span>bfh<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>
<br>
&nbsp; &nbsp; &nbsp;bfh.<span class="me1">bfType</span> <span class="sy1">=</span> <span class="nu12">0x4D42</span><span class="sy4">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">// Обозначим, что это bmp 'BM'</span><br>
&nbsp; &nbsp; &nbsp;bfh.<span class="me1">bfOffBits</span> <span class="sy1">=</span> <span class="kw3">sizeof</span><span class="br0">(</span>bfh<span class="br0">)</span> <span class="sy2">+</span> <span class="kw3">sizeof</span><span class="br0">(</span>bih<span class="br0">)</span> <span class="sy2">+</span> <span class="nu0">1024</span><span class="sy4">;</span> &nbsp; &nbsp;<span class="co1">// Палитра занимает 1Kb, но мы его использовать не будем</span><br>
&nbsp; &nbsp; &nbsp;bfh.<span class="me1">bfSize</span> <span class="sy1">=</span> bfh.<span class="me1">bfOffBits</span> <span class="sy2">+</span> <br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="kw3">sizeof</span><span class="br0">(</span>color<span class="br0">)</span> <span class="sy2">*</span> Width <span class="sy2">*</span> Height <span class="sy2">+</span> <br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Height <span class="sy2">*</span> <span class="br0">(</span><span class="br0">(</span><span class="kw3">sizeof</span><span class="br0">(</span>color<span class="br0">)</span> <span class="sy2">*</span> Width<span class="br0">)</span> <span class="sy2">%</span> <span class="nu0">4</span><span class="br0">)</span><span class="sy4">;</span> &nbsp; &nbsp;<span class="co1">// Посчитаем размер конечного файла</span><br>
&nbsp; &nbsp; &nbsp;<span class="kw3">memset</span> <span class="br0">(</span><span class="sy3">&amp;</span>bih, <span class="nu0">0</span>, <span class="kw3">sizeof</span><span class="br0">(</span>bih<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;bih.<span class="me1">biSize</span> <span class="sy1">=</span> <span class="kw3">sizeof</span><span class="br0">(</span>bih<span class="br0">)</span><span class="sy4">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="co1">// Так положено</span><br>
&nbsp; &nbsp; &nbsp;bih.<span class="me1">biBitCount</span> <span class="sy1">=</span> <span class="nu0">16</span><span class="sy4">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">// 16 бит на пиксель</span><br>
&nbsp; &nbsp; &nbsp;bih.<span class="me1">biClrUsed</span> <span class="sy1">=</span> <span class="nu0">32768</span><span class="sy4">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">// Мы используем 5-5-5</span><br>
&nbsp; &nbsp; &nbsp;bih.<span class="me1">biCompression</span> <span class="sy1">=</span> BI_RGB<span class="sy4">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="co1">// Без сжатия</span><br>
&nbsp; &nbsp; &nbsp;bih.<span class="me1">biHeight</span> <span class="sy1">=</span> Height<span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;bih.<span class="me1">biWidth</span> <span class="sy1">=</span> Width<span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;bih.<span class="me1">biPlanes</span> <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="co1">// Должно быть 1</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">// А остальные поля остаются 0</span><br>
<br>
&nbsp; &nbsp; &nbsp;hFile <span class="sy1">=</span> CreateFile <span class="br0">(</span>fname, GENERIC_WRITE, <span class="nu0">0</span>, <span class="kw2">NULL</span>, CREATE_ALWAYS, <span class="nu0">0</span>, <span class="kw2">NULL</span><span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;<span class="kw1">if</span> <span class="br0">(</span>hFile <span class="sy1">==</span> INVALID_HANDLE_VALUE<span class="br0">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="kw1">return</span><span class="sy4">;</span><br>
<br>
&nbsp; &nbsp; &nbsp;<span class="co1">// Запишем заголовки</span><br>
&nbsp; &nbsp; &nbsp;WriteFile <span class="br0">(</span>hFile, <span class="sy3">&amp;</span>bfh, <span class="kw3">sizeof</span> <span class="br0">(</span>bfh<span class="br0">)</span>, <span class="sy3">&amp;</span>RW, <span class="kw2">NULL</span><span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;WriteFile <span class="br0">(</span>hFile, <span class="sy3">&amp;</span>bih, <span class="kw3">sizeof</span> <span class="br0">(</span>bih<span class="br0">)</span>, <span class="sy3">&amp;</span>RW, <span class="kw2">NULL</span><span class="br0">)</span><span class="sy4">;</span><br>
<br>
&nbsp; &nbsp; &nbsp;<span class="co1">// Запишем палитру</span><br>
&nbsp; &nbsp; &nbsp;WriteFile <span class="br0">(</span>hFile, Palette, <span class="nu0">1024</span>, <span class="sy3">&amp;</span>RW, <span class="kw2">NULL</span><span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;<span class="kw1">for</span> <span class="br0">(</span>i <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span> i <span class="sy1">&lt;</span> Height<span class="sy4">;</span> i<span class="sy2">++</span><span class="br0">)</span><br>
&nbsp; &nbsp; &nbsp;<span class="br0">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="kw1">for</span> <span class="br0">(</span>j <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span> j <span class="sy1">&lt;</span> Width<span class="sy4">;</span> j<span class="sy2">++</span><span class="br0">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="br0">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WriteFile <span class="br0">(</span>hFile, <span class="sy3">&amp;</span>color, <span class="kw3">sizeof</span><span class="br0">(</span>color<span class="br0">)</span>, <span class="sy3">&amp;</span>RW, <span class="kw2">NULL</span><span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="br0">}</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="co1">// Выровняем по границе</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WriteFile <span class="br0">(</span>hFile, Palette, <span class="br0">(</span><span class="kw3">sizeof</span> <span class="br0">(</span>color<span class="br0">)</span> <span class="sy2">*</span> Width<span class="br0">)</span> <span class="sy2">%</span> <span class="nu0">4</span>, <span class="sy3">&amp;</span>RW, <span class="kw2">NULL</span><span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;<span class="br0">}</span><br>
&nbsp; &nbsp; &nbsp;CloseHandle<span class="br0">(</span>hFile<span class="br0">)</span><span class="sy4">;</span><br>
&nbsp;<span class="br0">}</span></div></div>
  <div class="sourceblocklink"><a href="http://jenyay.net/Programming/Bmp?action=sourceblock&amp;num=5" type="text/plain">[$[Get Code]]</a></div>
</div>

<p class="vspace">color - цвет картинки. Значение этой переменной должно
 быть заполнено в соответствии с первой таблицей. Получившуюся картинку 
вы можете посмотреть в ACDSee, например. Просто я пробовал ее открыть в 
Photoshop'е, оказалось, что в этом формате он их читать не умеет. А вы 
можете :).
</p>
<p class="vspace">Пример 2. Преобразование картинки из формата 8 бит (256 цветов) в 24 бит. 
</p>
<div class="vspace"></div>
<div class="sourceblock " id="sourceblock6">
  <div class="sourceblocktext"><div class="cpp" style="font-family:monospace;">BOOL Convert256To24 <span class="br0">(</span><span class="kw4">char</span> <span class="sy2">*</span>fin, <span class="kw4">char</span> <span class="sy2">*</span>fout<span class="br0">)</span><br>
&nbsp;<span class="br0">{</span><br>
&nbsp; &nbsp; &nbsp;BITMAPFILEHEADER bfh<span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;BITMAPINFOHEADER bih<span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;<span class="kw4">int</span> Width, Height<span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;RGBQUAD Palette<span class="br0">[</span><span class="nu0">256</span><span class="br0">]</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;BYTE <span class="sy2">*</span>inBuf<span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;RGBTRIPLE <span class="sy2">*</span>outBuf<span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;HANDLE hIn, hOut<span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;DWORD RW<span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;DWORD OffBits<span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;<span class="kw4">int</span> i, j<span class="sy4">;</span><br>
<br>
&nbsp; &nbsp; &nbsp;hIn <span class="sy1">=</span> CreateFile <span class="br0">(</span>fin, GENERIC_READ, FILE_SHARE_READ, <span class="kw2">NULL</span>, OPEN_EXISTING, <span class="nu0">0</span>, <span class="kw2">NULL</span><span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;<span class="kw1">if</span> <span class="br0">(</span>hIn <span class="sy1">==</span> INVALID_HANDLE_VALUE<span class="br0">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="kw1">return</span> FALSE<span class="sy4">;</span><br>
<br>
&nbsp; &nbsp; &nbsp;hOut <span class="sy1">=</span> CreateFile <span class="br0">(</span>fout, GENERIC_WRITE, <span class="nu0">0</span>, <span class="kw2">NULL</span>, CREATE_ALWAYS, <span class="nu0">0</span>, <span class="kw2">NULL</span><span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;<span class="kw1">if</span> <span class="br0">(</span>hOut <span class="sy1">==</span> INVALID_HANDLE_VALUE<span class="br0">)</span><br>
&nbsp; &nbsp; &nbsp;<span class="br0">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CloseHandle <span class="br0">(</span>hIn<span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="kw1">return</span> FALSE<span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;<span class="br0">}</span><br>
<br>
&nbsp; &nbsp; &nbsp;<span class="co1">// Прочтем данные</span><br>
&nbsp; &nbsp; &nbsp;ReadFile <span class="br0">(</span>hIn, <span class="sy3">&amp;</span>bfh, <span class="kw3">sizeof</span><span class="br0">(</span>bfh<span class="br0">)</span>, <span class="sy3">&amp;</span>RW, <span class="kw2">NULL</span><span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;ReadFile <span class="br0">(</span>hIn, <span class="sy3">&amp;</span>bih, <span class="kw3">sizeof</span><span class="br0">(</span>bih<span class="br0">)</span>, <span class="sy3">&amp;</span>RW, <span class="kw2">NULL</span><span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;ReadFile <span class="br0">(</span>hIn, Palette, <span class="nu0">256</span> <span class="sy2">*</span> <span class="kw3">sizeof</span><span class="br0">(</span>RGBQUAD<span class="br0">)</span>, <span class="sy3">&amp;</span>RW, <span class="kw2">NULL</span><span class="br0">)</span><span class="sy4">;</span><br>
<br>
&nbsp; &nbsp; &nbsp;<span class="co1">// Установим указатель на начало растра</span><br>
&nbsp; &nbsp; &nbsp;SetFilePointer <span class="br0">(</span>hIn, bfh.<span class="me1">bfOffBits</span>, <span class="kw2">NULL</span>, FILE_BEGIN<span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;Width <span class="sy1">=</span> bih.<span class="me1">biWidth</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;Height <span class="sy1">=</span> bih.<span class="me1">biHeight</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;OffBits <span class="sy1">=</span> bfh.<span class="me1">bfOffBits</span><span class="sy4">;</span><br>
<br>
&nbsp; &nbsp; &nbsp;<span class="co1">// Выделим память</span><br>
&nbsp; &nbsp; &nbsp;inBuf <span class="sy1">=</span> <span class="kw3">new</span> BYTE <span class="br0">[</span>Width<span class="br0">]</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;outBuf <span class="sy1">=</span> <span class="kw3">new</span> RGBTRIPLE <span class="br0">[</span>Width<span class="br0">]</span><span class="sy4">;</span><br>
<br>
&nbsp; &nbsp; &nbsp;<span class="co1">// Заполним заголовки</span><br>
&nbsp; &nbsp; &nbsp;bfh.<span class="me1">bfOffBits</span> <span class="sy1">=</span> <span class="kw3">sizeof</span> <span class="br0">(</span>bfh<span class="br0">)</span> <span class="sy2">+</span> <span class="kw3">sizeof</span> <span class="br0">(</span>bih<span class="br0">)</span><span class="sy4">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">// Не будем писать палитру</span><br>
&nbsp; &nbsp; &nbsp;bih.<span class="me1">biBitCount</span> <span class="sy1">=</span> <span class="nu0">24</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;bfh.<span class="me1">bfSize</span> <span class="sy1">=</span> bfh.<span class="me1">bfOffBits</span> <span class="sy2">+</span> <span class="nu0">4</span> <span class="sy2">*</span> Width <span class="sy2">*</span> Height <span class="sy2">+</span> Height <span class="sy2">*</span> <span class="br0">(</span>Width <span class="sy2">%</span> <span class="nu0">4</span><span class="br0">)</span><span class="sy4">;</span> &nbsp; &nbsp;<span class="co1">// Размер файла</span><br>
<br>
&nbsp; &nbsp; &nbsp;<span class="co1">// А остальное не меняется</span><br>
&nbsp; &nbsp; &nbsp;<span class="co1">// Запишем заголовки</span><br>
&nbsp; &nbsp; &nbsp;WriteFile <span class="br0">(</span>hOut, <span class="sy3">&amp;</span>bfh, <span class="kw3">sizeof</span><span class="br0">(</span>bfh<span class="br0">)</span>, <span class="sy3">&amp;</span>RW, <span class="kw2">NULL</span><span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;WriteFile <span class="br0">(</span>hOut, <span class="sy3">&amp;</span>bih, <span class="kw3">sizeof</span><span class="br0">(</span>bih<span class="br0">)</span>, <span class="sy3">&amp;</span>RW, <span class="kw2">NULL</span><span class="br0">)</span><span class="sy4">;</span><br>
<br>
&nbsp; &nbsp; &nbsp;<span class="co1">// Начнем преобразовывать</span><br>
&nbsp; &nbsp; &nbsp;<span class="kw1">for</span> <span class="br0">(</span>i <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span> i <span class="sy1">&lt;</span> Height<span class="sy4">;</span> i<span class="sy2">++</span><span class="br0">)</span><br>
&nbsp; &nbsp; &nbsp;<span class="br0">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ReadFile <span class="br0">(</span>hIn, inBuf, Width, <span class="sy3">&amp;</span>RW, <span class="kw2">NULL</span><span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="kw1">for</span> <span class="br0">(</span>j <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span> j <span class="sy1">&lt;</span> Width<span class="sy4">;</span> j<span class="sy2">++</span><span class="br0">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="br0">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;outBuf<span class="br0">[</span>j<span class="br0">]</span>.<span class="me1">rgbtRed</span> <span class="sy1">=</span> Palette<span class="br0">[</span>inBuf<span class="br0">[</span>j<span class="br0">]</span><span class="br0">]</span>.<span class="me1">rgbRed</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;outBuf<span class="br0">[</span>j<span class="br0">]</span>.<span class="me1">rgbtGreen</span> <span class="sy1">=</span> Palette<span class="br0">[</span>inBuf<span class="br0">[</span>j<span class="br0">]</span><span class="br0">]</span>.<span class="me1">rgbGreen</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;outBuf<span class="br0">[</span>j<span class="br0">]</span>.<span class="me1">rgbtBlue</span> <span class="sy1">=</span> Palette<span class="br0">[</span>inBuf<span class="br0">[</span>j<span class="br0">]</span><span class="br0">]</span>.<span class="me1">rgbBlue</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="br0">}</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WriteFile <span class="br0">(</span>hOut, outBuf, <span class="kw3">sizeof</span><span class="br0">(</span>RGBTRIPLE<span class="br0">)</span> <span class="sy2">*</span> Width, <span class="sy3">&amp;</span>RW, <span class="kw2">NULL</span><span class="br0">)</span><span class="sy4">;</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="co1">// Пишем мусор для выравнивания</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WriteFile <span class="br0">(</span>hOut, Palette, Width <span class="sy2">%</span> <span class="nu0">4</span>, <span class="sy3">&amp;</span>RW, <span class="kw2">NULL</span><span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SetFilePointer <span class="br0">(</span>hIn, <span class="br0">(</span><span class="nu0">3</span> <span class="sy2">*</span> Width<span class="br0">)</span> <span class="sy2">%</span> <span class="nu0">4</span>, <span class="kw2">NULL</span>, FILE_CURRENT<span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;<span class="br0">}</span><br>
<br>
&nbsp; &nbsp; &nbsp;<span class="kw3">delete</span> inBuf<span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;<span class="kw3">delete</span> outBuf<span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;CloseHandle <span class="br0">(</span>hIn<span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;CloseHandle <span class="br0">(</span>hOut<span class="br0">)</span><span class="sy4">;</span><br>
&nbsp; &nbsp; &nbsp;<span class="kw1">return</span> TRUE<span class="sy4">;</span><br>
&nbsp;<span class="br0">}</span></div></div>
  <div class="sourceblocklink"><a href="http://jenyay.net/Programming/Bmp?action=sourceblock&amp;num=6" type="text/plain">[$[Get Code]]</a></div>
</div>

<p class="vspace">В функцию надо передавать имена исходного и конечного файла соответственно.
</p>
<div class="vspace"></div><h3>Источники</h3>
<ol><li>Д. Гончаров, Т. Салихов. "DirectX 7.0 для программистов"
</li><li>MSDN
</li></ol><p class="vspace" style="text-align: center;"><script type="text/javascript"><!--
google_ad_client = 'ca-pub-4934988039890493';
/* article */
google_ad_slot = '2994245369';
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript" src="Bmp2_files/show_ads.js">
</script><ins style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px"><ins id="aswift_1_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px"><iframe allowtransparency="true" hspace="0" marginwidth="0" marginheight="0" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){i+='.call';setTimeout(h,0)}else if(h.match){i+='.nav';w.location.replace(h)}s.log&amp;&amp;s.log.push(i)}" vspace="0" id="aswift_1" name="aswift_1" style="left: 0pt; position: absolute; top: 0pt;" frameborder="0" height="90" scrolling="no" width="728"></iframe></ins></ins>
</p>
<div class="vspace"></div><div class="rater"> 
<h5>Пожалуйста, оцените материал</h5>
<p><img src="Bmp2_files/green45star.gif" alt="4.5 stars" title="4.5 stars"> <span style="font-size:83%">Рейтинг 4.3/</span><span style="font-size:69%">5</span>. <span style="font-size:83%"> Всего 216 голос(а, ов)</span>
</p><form action="http://jenyay.net/Programming/Bmp" method="post">
<div><input name="n" value="Programming.Bmp" type="hidden"><input name="action" value="rater" type="hidden"><input name="rs_id" value="1" type="hidden"><input name="rating_1[]" value="1" id="rating_11" type="radio"><label for="rating_11">Плохо</label> <input name="rating_1[]" value="2" id="rating_12" type="radio"><label for="rating_12">Так себе</label> <input name="rating_1[]" value="3" id="rating_13" type="radio"><label for="rating_13">Неплохо</label> <input name="rating_1[]" value="4" id="rating_14" type="radio"><label for="rating_14">Хорошо</label> <input name="rating_1[]" value="5" id="rating_15" type="radio"><label for="rating_15">Отлично</label> <input name="post" value="Голосовать" class="inputbutton" type="submit"><br><strong></strong>
</div></form>
</div>

<div class="vspace"></div><!-- AddThis Button BEGIN -->
	<script type="text/javascript">var addthis_pub="jenyay";</script>
	<a href="http://www.addthis.com/bookmark.php?v=20" style="text-decoration: none;" "="" onmouseover="return addthis_open(this, '', '[URL]', '[TITLE]')" onmouseout="addthis_close()" onclick="return addthis_sendto()"><!-- AddThis Button BEGIN -->
</a><div class="addthis_toolbox addthis_default_style "><a href="http://www.addthis.com/bookmark.php?v=20" style="text-decoration: none;" "="" onmouseover="return addthis_open(this, '', '[URL]', '[TITLE]')" onmouseout="addthis_close()" onclick="return addthis_sendto()">
</a><a href="#" title="Google_plusone" class="addthis_button_google_plusone at300b"><div id="___plusone_0" style="height: 15px; width: 70px; display: inline-block; text-indent: 0pt; margin: 0pt; padding: 0pt; background: none repeat scroll 0% 0% transparent; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline;"><iframe title="+1" src="Bmp2_files/fastbutton.htm" name="I0_1346744935685" id="I0_1346744935685" vspace="0" tabindex="0" style="position: static; top: 0pt; width: 70px; margin: 0px; border-style: none; left: 0pt; visibility: visible; height: 15px;" marginwidth="0" marginheight="0" hspace="0" allowtransparency="true" frameborder="0" scrolling="no" width="100%"></iframe></div></a>
<a href="#" title="Tweet" class="addthis_button_tweet at300b"><iframe data-twttr-rendered="true" title="Twitter Tweet Button" style="width: 110px; height: 20px;" class="twitter-share-button twitter-count-horizontal" src="Bmp2_files/tweet_button.htm" allowtransparency="true" frameborder="0" scrolling="no"></iframe></a>
<a href="#" title="Facebook_like" class="addthis_button_facebook_like at300b" fb:like:layout="button_count" fb:like:width="130"><iframe src="Bmp2_files/like.htm" style="overflow: hidden; border: 0px none; width: 130px; height: 25px;"></iframe></a>
<a title="Livejournal" target="_blank" href="http://www.addthis.com/bookmark.php?v=200&amp;winname=addthis&amp;pub=Jenyay&amp;source=tbx-200&amp;lng=ru-RU&amp;s=livejournal&amp;url=http%3A%2F%2Fjenyay.net%2FProgramming%2FBmp&amp;title=%D0%9E%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D0%B0%20BMP%20%7C%20%D0%A1%D0%BE%D1%84%D1%82%2C%20%D0%B8%D1%81%D1%85%D0%BE%D0%B4%D0%BD%D0%B8%D0%BA%D0%B8%20%D0%B8%20%D1%84%D0%BE%D1%82%D0%BE&amp;ate=AT-Jenyay/-/-/5045b2646860ce81/1&amp;frommenu=1&amp;uid=5045b264fe6652e0&amp;ufbl=1&amp;ct=1&amp;pre=http%3A%2F%2Fwww.google.by%2Furl%3Fsa%3Dt%26rct%3Dj%26q%3D%25D1%2584%25D0%25BE%25D1%2580%25D0%25BC%25D0%25B0%25D1%2582%2Bbmp%26source%3Dweb%26cd%3D7%26ved%3D0CD4QFjAG%26url%3Dhttp%253A%252F%252Fjenyay.net%252FProgramming%252FBmp%26ei%3DybBFUPHsDsf5sgaR9IHwBw%26usg%3DAFQjCNEDcDAlRc5zyl0LvjCy7bMh2UG4mA&amp;tt=0" class="addthis_button_livejournal at300b"><span class="at16nc at300bs at15nc at15t_livejournal at16t_livejournal"><span class="at_a11y">Share on livejournal</span></span></a>
<a href="#" title="Vk" target="_blank" class="addthis_button_vk at300b"><span class="at16nc at300bs at15nc at15t_vk at16t_vk"><span class="at_a11y">Share on vk</span></span></a>
<a href="#" style="display: block;" class="addthis_counter addthis_pill_style"><a class="atc_s addthis_button_compact"><span></span></a><a href="#" title="View more services" class="addthis_button_expanded"></a></a>
<div class="atclear"></div></div>
<script type="text/javascript">var addthis_config = {"data_track_clickback":true};</script>
<script type="text/javascript" src="Bmp2_files/addthis_widget.js"></script>
<!-- AddThis Button END --><script type="text/javascript" src="Bmp2_files/addthis_widget_002.js"></script><!-- AddThis Button END -->
<hr>
<div class="messagehead">
<p class="vspace"><strong></strong>&nbsp;<span style="font-size:83%">06.12.2007 - 18:17</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p><img src="Bmp2_files/confused.gif" alt="confused smiley" title="confused smiley" class="smiley" border="0" height="22" width="15">
</p></div>
<div class="messagehead">
<p class="vspace"><strong></strong>&nbsp;<span style="font-size:83%">24.02.2008 - 20:25</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>как это вы додумались до этого?
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Jenyay</strong>&nbsp;<span style="font-size:83%">25.02.2008 - 19:23</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>До чего именно?
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Хорош_гусь))</strong>&nbsp;<span style="font-size:83%">26.02.2008 - 22:18</span>
</p></div><div class="messageitem"> 
<p><strong>Big Endian - Small Endian</strong>
</p></div>
<div class="messageitem">
<p>Надо ещё учесть то, что все числа лежат в формате Big Endian, т.е. байты местами переставлены! Я до этого долго доходил!
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Сергей</strong>&nbsp;<span style="font-size:83%">11.07.2008 - 17:00</span>
</p></div><div class="messageitem"> 
<p><strong>программы для открытия структуры файла  BMP</strong>
</p></div>
<div class="messageitem">
<p>Здравствуйте подскажите какие программы позволяют открывать структуру любого файла BMP (с просмотром кода каждого пикселя)? 
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Фосса</strong>&nbsp;<span style="font-size:83%">05.11.2008 - 12:15</span>
</p></div><div class="messageitem"> 
<p><strong>Little Endian!</strong>
</p></div>
<div class="messageitem">
<p>Таки данные представлены в формате Little Endian, то есть младшим байтом-вперёд }=
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Den</strong>&nbsp;<span style="font-size:83%">08.01.2009 - 13:04</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>Так если это взято из MSDN, тогда почему другие графические
<br>редакторы не могут открыть файл в этом формате????????
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Jenyay</strong>&nbsp;<span style="font-size:83%">08.01.2009 - 17:32</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>Какой файл?
</p></div>
<div class="messagehead">
<p class="vspace"><strong>amarant555</strong>&nbsp;<span style="font-size:83%">13.02.2009 - 15:04</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>пробовал на делфи работать с файлом созданым фотожоп &gt;16 бит
<br>не воспринимает видимо там 5-5-5 вместо 5-6-5 (с которым умеет работать делфи)
<br>кому не трудно можете проверить прав я или нет.
</p></div>
<div class="messagehead">
<p class="vspace"><strong>amarant555</strong>&nbsp;<span style="font-size:83%">13.02.2009 - 15:07</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>поправка вернее делфи работает с файлом 16 бит но воспринимает формат как кастом, при этом не возможно использовать ряд функций.
</p></div>
<div class="messagehead">
<p class="vspace"><strong>PanzerDogg</strong>&nbsp;<span style="font-size:83%">22.02.2009 - 22:55</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>GOOD!!!
</p></div>
<div class="messagehead">
<p class="vspace"><strong></strong>&nbsp;<span style="font-size:83%">26.02.2009 - 09:43</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p><img src="Bmp2_files/confused.gif" alt="confused smiley" title="confused smiley" class="smiley" border="0" height="22" width="15"><img src="Bmp2_files/mad.gif" alt="angry smiley" title="angry smiley" class="smiley" border="0" height="15" width="15">
</p></div>
<div class="vspace"></div><div class="messagehead">
<p class="vspace"><strong></strong>&nbsp;<span style="font-size:83%">10.05.2009 - 17:50</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>Мне очень понравилось содержание, но все же стоит сделать текст 
доступным не только для программистов, или студентов-программистов. 
Почему не сделать эту статью более выразительной и доступной
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Jenyay</strong>&nbsp;<span style="font-size:83%">10.05.2009 - 17:57</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>Просто интересно, а кому может понадобиться описание формата файла кроме программистов?
</p></div>
<div class="messagehead">
<p class="vspace"><strong>DiezAver</strong>&nbsp;<span style="font-size:83%">16.05.2009 - 11:18</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>мне вот очень интересно, а в этом месте:
</p>
<div class="vspace"></div><pre> // Пишем мусор для выравнивания
         WriteFile (hOut, Palette, Width % 4, &amp;RW, NULL);
         SetFilePointer (hIn, (3 * Width) % 4, NULL, FILE_CURRENT);
</pre><p class="vspace">пишется мусор размером Width % 4. При размере картинки, скажем 255, Width % 4 будет = 3, но разве записать надо не на 1 байт?
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Jenyay</strong>&nbsp;<span style="font-size:83%">16.05.2009 - 11:23</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>Нет, нужно писать не один байт, потому что один пиксель занимает три 
байта. Если бы картинка была 8-битовая, а не 24-битовой, то достаточно 
было бы одного байта.
</p></div>
<div class="messagehead">
<p class="vspace"><strong>DiezAver</strong>&nbsp;<span style="font-size:83%">19.05.2009 - 09:01</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>О, действительно, просто я как раз с 8-битовыми сейчас работаю
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Влад</strong>&nbsp;<span style="font-size:83%">01.06.2009 - 19:08</span>
</p></div><div class="messageitem"> 
<p><strong>Проблема с чтением палитры</strong>
</p></div>
<div class="messageitem">
<p>Я создал 256-цветный рисунок в стандартном <span style="color: red;">Paint'е</span>. В програме загрузил рисунок и палитру, но цвета отображаются неправильно(нету оттенков красного).
<br>Так загружаю палитру:
</p><pre class="escaped">for(int i=0; i&lt;256; i++){
    fin.get(color.blue);
    fin.get(color.green);
    fin.get(color.red);
    fin.get(reserved);
    setPaletteRegistr(i, &amp;color);
  }</pre>
</div>
<div class="messagehead">
<p class="vspace"><strong>daim</strong>&nbsp;<span style="font-size:83%">31.07.2009 - 08:10</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>такой вот глупый вопросец:
<br>с 24 бит на пиксель понятно
<br>допустим белый - FF FF FF
<br>читаем каждый канал и записываем
<br>В свои байтные переменные
<br>а с 16 бит на пиксель как?
<br>тотже белый FF 7F FF?
<br>как то через маску....?
<br>и размер параграфа то же будьте добры,
<br>просто первый раз здесь услышал
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Джей</strong>&nbsp;<span style="font-size:83%">13.11.2009 - 17:04</span>
</p></div><div class="messageitem"> 
<p><strong>"...есть надписи на русском языке"</strong>
</p></div>
<div class="messageitem">
<p>&gt; "BitMaP - битовая карта, или, говоря по-русски, битовый массив"
<br>Вообще-то слово "массив" - французского происхождения (massif от massiz).
<br>Но это мелочи. Я тут чеек посторонний, просветите: што за язык 
чудной вы используете для программ своих написания? Уж не Си ли это?
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Jenyay</strong>&nbsp;<span style="font-size:83%">13.11.2009 - 17:11</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p><strong>Джей</strong>
</p>
<p class="vspace">Да, Си, но тут не столько сам язык, сколько вызовы функций WinAPI, от самого языка не так много осталось :)
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Джей</strong>&nbsp;<span style="font-size:83%">17.11.2009 - 10:51</span>
</p></div><div class="messageitem"> 
<p><strong>Si, si...</strong>
</p></div>
<div class="messageitem">
<p>Я щас пишу на C# (уж больно заказчик формы любит...). Какую среду разработки посоветуете?
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Jenyay</strong>&nbsp;<span style="font-size:83%">17.11.2009 - 10:55</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>Visual C# Express, если не хочется денег на среду тратить.
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Джей</strong>&nbsp;<span style="font-size:83%">17.11.2009 - 11:28</span>
</p></div><div class="messageitem"> 
<p><strong>Ah, bien merci, merci bien...</strong>
</p></div>
<div class="messageitem">
<p>Mille mercis...
<br>З.ы. source: "Распространенье наше по планете / Особенно заметно 
вдалеке. / В общественном парижском туалете / Есть надписи на русском 
языке" (В.С. Высоцкий)
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Джей</strong>&nbsp;<span style="font-size:83%">17.11.2009 - 17:32</span>
</p></div><div class="messageitem"> 
<p><strong>mille pardons</strong>
</p></div>
<div class="messageitem">
<p><span style="color: green;">Je m'excuse de vous demander pardon... Вы в ЦОИз шарите? Если да, в чём именно?</span>
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Jenyay</strong>&nbsp;<span style="font-size:83%">30.11.2009 - 22:26</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>В ЦОИ скорее теоретически представляю что к чему. А вообще по работе я
 иногда занимаюсь обработкой несколько специфических изображений 
(радиоизображений).
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Людмила</strong>&nbsp;<span style="font-size:83%">17.01.2010 - 18:44</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>Очень важная для меня, интересная информация. Большое спасибо. Удачи, здоровья.
</p></div>
<div class="vspace"></div><div class="messagehead">
<p class="vspace"><strong>murder</strong>&nbsp;<span style="font-size:83%">07.04.2010 - 13:52</span>
</p></div><div class="messageitem"> 
<p><strong>16-битные изображения</strong>
</p></div>
<div class="messageitem">
<p>По моим наблюдениям Photoshop не использует поле biClrUsed.
</p>
<p class="vspace">Алгоритм такой:
<br>Если поле biCompression равно BI_RGB то формат 5:5:5. Если же это 
поле содержит BI_BITFIELDS, то цвета нужно считывать согласно маскам 
bV5RedMask, bV5GreenMask, bV5BlueMask.
</p>
<p class="vspace">Кроме того BI_BITFIELDS в сочетании с масками 
позволяет менять расположение цветов (например RGB вместо стандартного 
BGR). Я проверял это на функции SetDIBitsToDevice - работает.
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Domen0</strong>&nbsp;<span style="font-size:83%">25.05.2010 - 12:08</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>Огромное спасибо! Наконец-то нашел.<img src="Bmp2_files/biggrin.gif" alt="grinning smiley" title="grinning smiley" class="smiley" border="0" height="15" width="15">
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Винт</strong>&nbsp;<span style="font-size:83%">01.09.2010 - 18:27</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>маленькая поправочка для концовки
<br>...
</p><pre>     delete[] inBuf;
     delete[] outBuf;
</pre></div>
<div class="messagehead">
<p class="vspace"><strong></strong>&nbsp;<span style="font-size:83%">25.09.2010 - 20:07</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p><img src="Bmp2_files/eek.gif" alt="shrieking smiley" title="shrieking smiley" class="smiley" border="0" height="15" width="15"><img src="Bmp2_files/confused.gif" alt="confused smiley" title="confused smiley" class="smiley" border="0" height="22" width="15"><img src="Bmp2_files/sad.gif" alt="frowning smiley" title="frowning smiley" class="smiley" border="0" height="15" width="15"><img src="Bmp2_files/mad.gif" alt="angry smiley" title="angry smiley" class="smiley" border="0" height="15" width="15">
</p></div>
<div class="messagehead">
<p class="vspace"><strong></strong>&nbsp;<span style="font-size:83%">01.10.2010 - 18:14</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p><img src="Bmp2_files/eek.gif" alt="shrieking smiley" title="shrieking smiley" class="smiley" border="0" height="15" width="15"><img src="Bmp2_files/eek.gif" alt="shrieking smiley" title="shrieking smiley" class="smiley" border="0" height="15" width="15"><img src="Bmp2_files/eek.gif" alt="shrieking smiley" title="shrieking smiley" class="smiley" border="0" height="15" width="15"><img src="Bmp2_files/eek.gif" alt="shrieking smiley" title="shrieking smiley" class="smiley" border="0" height="15" width="15"><img src="Bmp2_files/eek.gif" alt="shrieking smiley" title="shrieking smiley" class="smiley" border="0" height="15" width="15"><img src="Bmp2_files/eek.gif" alt="shrieking smiley" title="shrieking smiley" class="smiley" border="0" height="15" width="15"><img src="Bmp2_files/eek.gif" alt="shrieking smiley" title="shrieking smiley" class="smiley" border="0" height="15" width="15"><img src="Bmp2_files/eek.gif" alt="shrieking smiley" title="shrieking smiley" class="smiley" border="0" height="15" width="15">
</p></div>
<div class="messagehead">
<p class="vspace"><strong>))))</strong>&nbsp;<span style="font-size:83%">21.12.2010 - 05:54</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p><img src="Bmp2_files/confused.gif" alt="confused smiley" title="confused smiley" class="smiley" border="0" height="22" width="15"><img src="Bmp2_files/mad.gif" alt="angry smiley" title="angry smiley" class="smiley" border="0" height="15" width="15"><img src="Bmp2_files/eek.gif" alt="shrieking smiley" title="shrieking smiley" class="smiley" border="0" height="15" width="15">
</p></div>
<div class="messagehead">
<p class="vspace"><strong></strong>&nbsp;<span style="font-size:83%">14.01.2011 - 20:55</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>здесь никто ни чего не знает
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Ротва</strong>&nbsp;<span style="font-size:83%">18.01.2011 - 02:09</span>
</p></div><div class="messageitem"> 
<p><strong>Амет</strong>
</p></div>
<div class="messageitem">
<p>Написал собственную прогу по этой статье. Спасибо.
<br>Проверил все варианты, за исключением 5-5-5, 5-6-5. 
<br>Если у кого-то есть изображения с таким форматом и БЕЗ сжатия, очень прошу выложить на <a class="urllink" href="http://pixs.ru/">http://pixs.ru/</a>
<br>и скинуть линк сюда! thx!
</p></div>
<div class="messagehead">
<p class="vspace"><strong>апт</strong>&nbsp;<span style="font-size:83%">12.03.2011 - 11:01</span>
</p></div><div class="messageitem"> 
<p><strong>врт</strong>
</p></div>
<div class="messageitem">
<p>ку<img src="Bmp2_files/biggrin.gif" alt="grinning smiley" title="grinning smiley" class="smiley" border="0" height="15" width="15">
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Duk Nukem</strong>&nbsp;<span style="font-size:83%">27.10.2011 - 20:43</span>
</p></div><div class="messageitem"> 
<p><strong>Ошибка в программе </strong>
</p></div>
<div class="messageitem">
<p>Ваша программа при компиляции выдаёт ошибку в строке:
</p>
<p class="vspace">hFile = CreateFile (fname, GENERIC_WRITE, 0, NULL, CREATE_ALWAYS, 0, NULL);
</p>
<p class="vspace">fname неправильного типа.Как исправить это?
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Jenyay</strong>&nbsp;<span style="font-size:83%">29.10.2011 - 09:47</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>Попробовал сейчас скомпилировать исходник в Visual C++ 2008 Express, все скомпилировалось. А у Вас каком компилятор?
</p></div>
<div class="messagehead">
<p class="vspace"><strong>eugrita</strong>&nbsp;<span style="font-size:83%">27.12.2011 - 05:41</span>
</p></div><div class="messageitem"> 
<p><strong>создание BMP</strong>
</p></div>
<div class="messageitem">
<p>у меня ваша программа создала BMP-файл, но просмотр его оказался недоступен. Почему??? (Win XP)
</p></div>
<div class="messagehead">
<p class="vspace"><strong>eugrita</strong>&nbsp;<span style="font-size:83%">27.12.2011 - 05:43</span>
</p></div><div class="messageitem"> 
<p><strong>cоздание BMP</strong>
</p></div>
<div class="messageitem">
<p>При попытке открытия Paint говорит что недостаточно ресурсов для выполнения операции
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Slavon G.</strong>&nbsp;<span style="font-size:83%">11.01.2012 - 02:26</span>
</p></div><div class="messageitem"> 
<p><strong>re: создание BMP</strong>
</p></div>
<div class="messageitem">
<p><strong>eugrita</strong>, тяжело что-то сказать, не видя кода программы
<br><strong>Jenyay</strong>, а вот тут ошибочка<img src="Bmp2_files/happy.gif" alt="happy smiley" title="happy smiley" class="smiley" border="0" height="15" width="15">
<br>//Convert256To24()
<br>bfh.bfSize = bfh.bfOffBits + <strong>3</strong> * Width * Height + Height * (Width % 4);
</p></div>
<div class="messagehead">
<p class="vspace"><strong>Slavon G</strong>&nbsp;<span style="font-size:83%">11.01.2012 - 02:29</span>
</p></div><div class="messageitem"> 
<p><strong>re: создание BMP</strong>
</p></div>
<div class="messageitem">
<p>Поэтому в последний рисунок, размер файла записывается в заголовок неправильно.
</p>
<p class="vspace">PS: каптча любит шестерки<img src="Bmp2_files/eek.gif" alt="shrieking smiley" title="shrieking smiley" class="smiley" border="0" height="15" width="15">
</p></div>
<div class="messagehead">
<p class="vspace"><strong>mao</strong>&nbsp;<span style="font-size:83%">12.08.2012 - 14:55</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>А сколько здесь байт в LONG? что-то я смотрю в редакторе одну 
бмп-картинку и похоже на то, что 4, но в чём тогда отличие от dword?
</p></div>
<div class="messagehead">
<p class="vspace"><strong>mao</strong>&nbsp;<span style="font-size:83%">12.08.2012 - 15:24</span>
</p></div><div class="messageitem"> 
<p><strong></strong>
</p></div>
<div class="messageitem">
<p>А, википедия популярно объясняет, что
<br>« Тип WORD должен иметь размер 16 бит, типы DWORD и LONG — 32 бита, 
тип LONG — знаковый, порядок байтов подразумевается little endian. »
</p>
<p class="vspace">Касательно этого  два вопроса: 
<br>1) зачем знаковость в biWidth и biHeight?
<br>2) little endian везде или только в long?
</p></div>
<div class="vspace"></div><form action="http://jenyay.net/Programming/Bmp" method="post"> 
<input name="foxpage" value="Programming.Bmp" type="hidden"> 
<input name="action" value="foxpost" type="hidden"> 
<input name="foxname" value="cbox" type="hidden"> 
<input name="put" value="above" type="hidden"> 
<input name="template" value="Site.FoxCommentTemplate" type="hidden"> 
<input name="target" value="Programming.Bmp-Comments" type="hidden"> 

<hr>
<table border="0"><tbody><tr><td align="right"><a class="wikilink" href="http://jenyay.net/Programming/Bmp-Comments?action=pagefeed"><img src="Bmp2_files/feed_24.png" alt=""></a></td><td><a class="wikilink" href="http://jenyay.net/Programming/Bmp-Comments?action=pagefeed">Подписаться на комментарии</a></td></tr>
<tr><td align="right">Автор:</td><td><input name="author" class="inputbox" type="text"></td></tr>
<tr><td align="right">Тема:</td><td><input name="heading" class="inputbox" size="60" type="text"></td></tr>
<tr><td>&nbsp;</td><td align="left"><strong>Ваш комментарий</strong></td></tr>
<tr><td>&nbsp;</td><td><script language="javascript" type="text/javascript">
insButton("\\'\\'", "\\'\\'", 'Выделено', "<img src='/pub/guibuttons/italic.gif' title='Курсивный шрифт' style='border:0px;' />", "");
insButton("\\'\\'\\'", "\\'\\'\\'", 'Усилено', "<img src='/pub/guibuttons/bold.gif' title='Полужирный шрифт' style='border:0px;' />", "");
insButton("{+", "+}", 'Underlined Text', "<img src='/pub/guibuttons/underline.gif' title='Underline' style='border:0px;' />", "");
insButton("\\'^", "^\\'", 'Верхний индекс', "<img src='/pub/guibuttons/sup.gif' title='Верхний индекс' style='border:0px;' />", "");
insButton("\\'_", "_\\'", 'Нижний индекс', "<img src='/pub/guibuttons/sub.gif' title='Нижний индекс' style='border:0px;' />", "");
insButton("%25center%25", "", '', "<img src='/pub/guibuttons/center.gif' title='Центрировать' style='border:0px;' />", "");
insButton("[[", "]]", 'Ссылка на страницу', "<img src='/pub/guibuttons/pagelink.gif' title='Ссылка на внутреннюю страницу' style='border:0px;' />", "");
insButton("[@", "@]", 'Code', "<img src='/pub/guibuttons/code.gif' title='Code' style='border:0px;' />", "");
insButton("", "", '', "<img src='/pub/guibuttons/spacer.gif'  style='border:0px;' />", "");
insButton("\\{happy\\}", "", '', "<img src='/pub/guibuttons/happy.gif' title='Happy' style='border:0px;' />", "");
insButton("", "", '', "<img src='/pub/guibuttons/pixspace.gif'  style='border:0px;' />", "");
insButton("\\{wink\\}", "", '', "<img src='/pub/guibuttons/wink.gif' title='Wink' style='border:0px;' />", "");
insButton("", "", '', "<img src='/pub/guibuttons/pixspace.gif'  style='border:0px;' />", "");
insButton("\\{cool\\}", "", '', "<img src='/pub/guibuttons/cool.gif' title='Cool' style='border:0px;' />", "");
insButton("", "", '', "<img src='/pub/guibuttons/pixspace.gif'  style='border:0px;' />", "");
insButton("\\{confused\\}", "", '', "<img src='/pub/guibuttons/confused.gif' title='Confused' style='border:0px;' />", "");
insButton("", "", '', "<img src='/pub/guibuttons/pixspace.gif'  style='border:0px;' />", "");
insButton("\\{eek\\}", "", '', "<img src='/pub/guibuttons/eek.gif' title='Eek' style='border:0px;' />", "");
insButton("", "", '', "<img src='/pub/guibuttons/pixspace.gif'  style='border:0px;' />", "");
insButton("\\{rolleyes\\}", "", '', "<img src='/pub/guibuttons/rolleyes.gif' title='Roll eyes' style='border:0px;' />", "");
insButton("", "", '', "<img src='/pub/guibuttons/pixspace.gif'  style='border:0px;' />", "");
insButton("\\{sad\\}", "", '', "<img src='/pub/guibuttons/sad.gif' title='Sad' style='border:0px;' />", "");
insButton("", "", '', "<img src='/pub/guibuttons/pixspace.gif'  style='border:0px;' />", "");
insButton("\\{mad\\}", "", '', "<img src='/pub/guibuttons/mad.gif' title='Mad' style='border:0px;' />", "");
insButton("", "", '', "<img src='/pub/guibuttons/pixspace.gif'  style='border:0px;' />", "");
insButton("\\{biggrin\\}", "", '', "<img src='/pub/guibuttons/biggrin.gif' title='Big grin' style='border:0px;' />", "");
</script><a tabindex="-1" onclick="insMarkup('\'\'','\'\'','Выделено');"><img src="Bmp2_files/italic.gif" title="Курсивный шрифт" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('\'\'\'','\'\'\'','Усилено');"><img src="Bmp2_files/bold.gif" title="Полужирный шрифт" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('{+','+}','Underlined Text');"><img src="Bmp2_files/underline.gif" title="Underline" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('\'^','^\'','Верхний индекс');"><img src="Bmp2_files/sup.gif" title="Верхний индекс" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('\'_','_\'','Нижний индекс');"><img src="Bmp2_files/sub.gif" title="Нижний индекс" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('%25center%25','','');"><img src="Bmp2_files/center.gif" title="Центрировать" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('[[',']]','Ссылка на страницу');"><img src="Bmp2_files/pagelink.gif" title="Ссылка на внутреннюю страницу" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('[@','@]','Code');"><img src="Bmp2_files/code.gif" title="Code" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('','','');"><img src="Bmp2_files/spacer.gif" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('\{happy\}','','');"><img src="Bmp2_files/happy.gif" title="Happy" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('','','');"><img src="Bmp2_files/pixspace.gif" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('\{wink\}','','');"><img src="Bmp2_files/wink.gif" title="Wink" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('','','');"><img src="Bmp2_files/pixspace.gif" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('\{cool\}','','');"><img src="Bmp2_files/cool.gif" title="Cool" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('','','');"><img src="Bmp2_files/pixspace.gif" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('\{confused\}','','');"><img src="Bmp2_files/confused.gif" title="Confused" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('','','');"><img src="Bmp2_files/pixspace.gif" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('\{eek\}','','');"><img src="Bmp2_files/eek.gif" title="Eek" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('','','');"><img src="Bmp2_files/pixspace.gif" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('\{rolleyes\}','','');"><img src="Bmp2_files/rolleyes.gif" title="Roll eyes" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('','','');"><img src="Bmp2_files/pixspace.gif" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('\{sad\}','','');"><img src="Bmp2_files/sad.gif" title="Sad" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('','','');"><img src="Bmp2_files/pixspace.gif" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('\{mad\}','','');"><img src="Bmp2_files/mad.gif" title="Mad" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('','','');"><img src="Bmp2_files/pixspace.gif" style="border: 0px none;"></a><a tabindex="-1" onclick="insMarkup('\{biggrin\}','','');"><img src="Bmp2_files/biggrin.gif" title="Big grin" style="border: 0px none;"></a></td></tr>
<tr><td>&nbsp;</td><td align="left"><textarea name="text" id="text" rows="6" cols="60"></textarea></td></tr>
<tr><td align="right">Введите код <span style="color: red;">843</span></td><td align="left"><input name="access" class="inputbox" type="text"><input name="accesscode" value="843" type="hidden"></td></tr>
<tr><td>&nbsp;</td><td><input name="post" value="Послать" class="inputbutton" type="submit"></td></tr>
</tbody></table></form>
</div>

      </td>
    </tr></tbody></table>
<!--PageFooterFmt-->
  <div id="wikifoot">
    <div class="footnav">
      <a rel="nofollow" href="http://jenyay.net/Programming/Bmp?action=edit">Править</a> -
      <a rel="nofollow" href="http://jenyay.net/Programming/Bmp?action=diff">История</a> -
      <a rel="nofollow" href="http://jenyay.net/Programming/Bmp?action=print" target="_blank">Печать</a> -
      <a href="http://jenyay.net/Programming/RecentChanges">Последние изменения</a> -
      <a href="http://jenyay.net/PmWikiRu/SiteSearch">Поиск</a></div>
    <div class="lastmod">Последняя редакция от 28.08.2012 17:01</div></div>
<!--HTMLFooter-->

<!-- Google Analytics-->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="Bmp2_files/ga.js" type="text/javascript"></script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1218080-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>
<!-- Google Analytics-->

<!-- reinvigorate.net-->
<!--<script type="text/javascript" src="http://include.reinvigorate.net/re_.js"></script>
<script type="text/javascript">
try {
reinvigorate.track("926cs-66ca131m10");
} catch(err) {}
</script> -->
<!-- reinvigorate.net-->


</body></html>